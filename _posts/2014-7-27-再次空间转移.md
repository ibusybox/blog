---
layout: post
title: 再次空间转移

---

第一次写博客是在MSN，大概10年时候转到QQ Zone，在QQ Zone上并么有写什么博客，所以现在看到的大部分都是在MSN上发表的。  

幸好我本地有一份TXT存档，才使得第二次空间转移变的可能。不过中间还是有一些曲折。  

缘由是这样的：从QQ Zone上导出为TXT时候，是Windows上的GBK编码，在MAC上文本编辑器打开显示乱码，也就是无法识别这种GBK编码。  
于是我就写了一段代码，将所有的TXT文件从GBK转为UTF-8编码，同时将TXT转换为JEKYLL可以识别的Markdown格式（就是在文件头加上yaml标记）。  
{% highlight ruby %}

---
layout: post
title: 再次空间转移

---

{% endhighlight %}



加上做饭，带崽，折腾了快一天，总算在夜深人静的时候，搞好了。夜深人静真是编码的好时光啊，要不为啥程序员都喜欢晚上工作呢。

代码共享给需要的同学。  
{% highlight ruby %}

def txt2md src_file_path, dest_file_path, head
  File.open src_file_path, "r:GBK" do |f|
    src_str = f.read
    File.open dest_file_path, 'w:UTF-8' do |wf|
      wf.write head
      wf.write src_str
    end
  end
end

def build_head file_name
  title = file_name.split('.').first
  head = "---\nlayout: post\ntitle: #{title}\n---\n"
  return head
end

dest_path = "/Users/mao/Desktop/Mao/workspace/space_md"
src_path = "/Users/mao/Desktop/Mao/workspace/SPACE"


Dir.new(src_path).each do |file_name|
  #file_name = file_name.force_encoding('UTF-8')
  puts "start process #{file_name}"

  if file_name.end_with? '.txt'
    src_file = "#{src_path}/#{file_name}"
    time = File.stat(src_file).mtime

    dest_file = "#{dest_path}/#{time.year}-#{time.mon}-#{time.day}-#{file_name.split('.').first}.md"

    txt2md src_file, dest_file, build_head(file_name)
  end
end

{% endhighlight %}


生命不息，博客不止。佛说博客，即非博客，是名博客。